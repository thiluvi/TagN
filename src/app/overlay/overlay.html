<div class="overlay-container" [class.visible]="isVisible">
  <div class="overlay-backdrop" (click)="onClose()"></div>

  <div class="overlay-panel">
    <div class="overlay-header">
      <h2>{{ title }}</h2>
      <button class="close-btn" (click)="onClose()">×</button>
    </div>
    
    <div class="overlay-content">
      
      <div [ngSwitch]="contentType">
        
        <div *ngSwitchCase="'Favoritos'">
          @if (favoriteItems().length > 0) {
            <div class="favorite-list">
              
              @for (item of favoriteItems(); track item.id) {
                <div class="favorite-item">

                  <a [routerLink]="['/products', item.id]" (click)="onClose()" class="favorite-item-link">
                    <img [src]="item.images[0]" alt="{{ item.name }}" class="favorite-item-image">
                    <div class="favorite-item-details">
                      <p class="favorite-item-name">{{ item.name }}</p>
                      <p class="favorite-item-price">R$ {{ item.price }}</p>
                    </div>
                  </a>
                  <button class="favorite-item-remove" (click)="handleRemoveFavorite($event, item.id)">
                    <img src="../../assets/images/coracao-partido.png" alt="Remover dos favoritos">
                  </button>
                  
                </div>
              }

            </div>
          } @else {
            <p>Seus itens favoritos aparecerão aqui.</p>
          }
        </div>

        <div *ngSwitchCase="'Sacola'">
          @if (cartService.cartItems().length > 0) {
            <div class="cart-list">
              
              @for (item of cartService.cartItems(); track $index) {
                <div class="cart-item">
                  
                  <div class="cart-item-img-wrapper">
                    <img [src]="item.product.images[0]" [alt]="item.product.name">
                  </div>

                  <div class="cart-item-info">
                    <p class="cart-item-name">{{ item.product.name }}</p>
                    
                    <div class="cart-item-specs">
                      @if (item.selectedSize) {
                        <span class="spec-tag">Tam: {{ item.selectedSize }}</span>
                      }
                      <span class="spec-tag">Qtd: {{ item.quantity }}</span>
                    </div>
                    
                    <p class="cart-item-price">R$ {{ item.product.price }}</p>
                  </div>

                  <button class="cart-item-remove" (click)="handleRemoveFromCart($event, item.product.id, item.selectedSize)">
                    <img src="../../assets/images/lixeira-de-reciclagem.png" alt="Remover do carrinho">
                  </button>

                </div>
              }

              <div class="cart-footer">
                <div class="cart-subtotal">
                  <span>Subtotal:</span>
                  <strong>{{ cartService.subtotalFormatted() }}</strong>
                </div>

                <button class="checkout-btn" (click)="finalizePurchase()">
                  Finalizar Compra
                  <img src="../../assets/images/Caminhao de entrega.png" class="btn-icon-small" alt=""> 
                </button>
                
                <button class="continue-btn" (click)="onClose()">
                  Continuar Comprando
                </button>
              </div>

            </div>
          } @else {
            <div class="empty-cart">
              <img src="../../assets/images/Sacola.png" alt="Sacola Vazia" class="empty-icon">
              <p>Sua sacola está vazia.</p>
              <button class="continue-btn" (click)="onClose()">Começar a comprar</button>
            </div>
          }
        </div>
        
        <div *ngSwitchDefault>
          <p>Conteúdo padrão ou erro.</p>
        </div>
      </div>

    </div>
  </div>
</div>