<div class="account-container">
  
  <aside class="account-sidebar">
    <div class="welcome-box">
      <h2>Painel Admin</h2>
      <p>Gerenciamento do Sistema</p>
    </div>
    <nav class="account-nav">
      <ul>
        <li>
          <button (click)="switchView('users')" [class.active]="activeView() === 'users'">
            <span class="nav-icon">üë§</span> Gerenciar Usu√°rios
          </button>
        </li>
        <li>
          <button (click)="switchView('products')" [class.active]="activeView() === 'products'">
            <span class="nav-icon">üíé</span> Gerenciar Produtos
          </button>
        </li>
      </ul>
    </nav>
    <button class="logout-button" (click)="handleLogout()">Sair</button>
  </aside>

  <section class="account-content">
    
    @if (feedbackMessage(); as msg) {
      <div class="feedback-message" [class.success]="msg.type === 'success'" [class.error]="msg.type === 'error'">
        {{ msg.text }}
      </div>
    }

    @if (activeView() === 'users') {
      <h2>Cadastrar Novo Usu√°rio</h2>
      
      <form class="admin-form" [formGroup]="registerForm" (ngSubmit)="handleRegisterUser()">
        
        <div class="form-group">
          <label for="nome">Nome Completo</label>
          <input type="text" id="nome" formControlName="nome">
          @if (f.nome.invalid && (f.nome.dirty || f.nome.touched)) {
            <div class="field-error-message">
              @if (f.nome.hasError('required')) {
                <p>Nome √© obrigat√≥rio.</p>
              }
            </div>
          }
        </div>
        
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" formControlName="email">
          @if (f.email.invalid && (f.email.dirty || f.email.touched)) {
            <div class="field-error-message">
              @if (f.email.hasError('required')) {
                <p>Email √© obrigat√≥rio.</p>
              }
              @if (f.email.hasError('email')) {
                <p>Formato de email inv√°lido.</p>
              }
            </div>
          }
        </div>
  
        <div class="form-group">
          <label for="cpf">CPF (somente n√∫meros)</label>
          <input type="text" id="cpf" formControlName="cpf" placeholder="12345678900">
        
          @if (f.cpf.invalid && (f.cpf.dirty || f.cpf.touched)) {
            <div class="field-error-message">
              @if (f.cpf.hasError('required')) {
                <p>CPF √© obrigat√≥rio.</p>
              }
              @if (f.cpf.hasError('pattern')) {
                <p>CPF deve conter apenas n√∫meros.</p>
              }
              @if (f.cpf.hasError('minlength') || f.cpf.hasError('maxlength')) {
                <p>CPF deve ter exatamente 11 d√≠gitos.</p>
              }
              @if (f.cpf.hasError('cpfInvalido')) {
                <p>Este CPF n√£o √© v√°lido. Verifique os d√≠gitos.</p>
              }
            </div>
          }
        </div>
        
        <div class="form-group">
          <label for="password">Senha Inicial</label>
          <input type="password" id="password" formControlName="password">
          @if (f.password.invalid && (f.password.dirty || f.password.touched)) {
            <div class="field-error-message">
              @if (f.password.hasError('required')) {
                <p>Senha √© obrigat√≥ria.</p>
              }
            </div>
          }
        </div>
        
        <div class="form-group">
          <label for="role">Tipo de Conta</label>
          <select id="role" formControlName="role">
            <option value="user">Usu√°rio Comum</option>
            <option value="admin">Administrador</option>
          </select>
        </div>
  
        <button type="submit" class="submit-button" [disabled]="registerForm.invalid">Cadastrar Usu√°rio</button>
      </form>
  
      <hr class="divider">
  
      <h2>Lista de Usu√°rios</h2>
      <div class="user-list-container">
        <table class="user-table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>CPF</th>
              <th>Permiss√£o</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            @for (user of users(); track user.id) {
              <tr>
                <td>{{ user.nome }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.cpf }}</td>
                <td>{{ user.role }}</td>
                <td class="actions-cell">
                  <button class="action-btn edit" (click)="openPasswordModal(user)">Alterar Senha</button>
                  
                  @if (user.email !== 'admin@senac.com') {
                    <button class="action-btn delete" (click)="handleDeleteUser(user.id)">Deletar</button>
                  }
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="5">Nenhum usu√°rio cadastrado.</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }

    @if (activeView() === 'products') {
      
      <h2>{{ editingProductId() ? 'Editar Produto' : 'Cadastrar Novo Produto' }}</h2>
      
      <form class="admin-form" [formGroup]="productForm" (ngSubmit)="handleSubmitProduct()">
        
        <div class="form-group">
          <label for="prodName">Nome do Produto</label>
          <input type="text" id="prodName" formControlName="name" placeholder="Ex: Corrente de Prata">
        </div>

        <div class="form-group">
          <label for="prodDesc">Descri√ß√£o</label>
          <textarea id="prodDesc" formControlName="description" rows="3" placeholder="Detalhes da joia..."></textarea>
        </div>

        <div class="form-row" style="display: flex; gap: 15px; flex-wrap: wrap;">
          <div class="form-group" style="flex: 1; min-width: 200px;">
            <label for="prodPrice">Pre√ßo (R$)</label>
            
            <input 
              type="text" 
              inputmode="decimal"
              id="prodPrice" 
              formControlName="price" 
              placeholder="00,00">
            
            @if (p.price.invalid && (p.price.dirty || p.price.touched)) {
              <div class="field-error-message">
                <small>Use v√≠rgula para centavos (ex: 99,90).</small>
              </div>
            }
          </div>
          
          <div class="form-group" style="flex: 1; min-width: 200px;">
            <label for="prodCat">Categoria</label>
            <select id="prodCat" formControlName="category">
              <option value="correntes">Correntes</option>
              <option value="pulseiras">Pulseiras</option>
              <option value="escapulario">Escapul√°rios</option>
              <option value="colares">Colares</option>
              <option value="aneis">An√©is</option>
              <option value="brincos">Brincos</option>
              <option value="pingentes">Pingentes</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Tamanhos Dispon√≠veis</label>
          <div class="sizes-grid">
            @for (size of availableSizes; track size) {
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [value]="size" 
                  [checked]="isSizeSelected(size)"
                  (change)="toggleSize(size, $event)">
                {{ size }}
              </label>
            }
          </div>
          <small style="color:#666">Selecionados: {{ selectedSizes().join(', ') }}</small>
        </div>

        <div class="form-group">
          <label>Foto de Capa (URL ou Caminho)</label>
          <input type="text" formControlName="imageMain" placeholder="assets/images/exemplo.png">
        </div>

        <div class="form-group">
          <label>Foto Secund√°ria (Opcional)</label>
          <input type="text" formControlName="imageExtra">
        </div>

        <div class="form-actions" style="display: flex; gap: 10px; margin-top: 10px;">
          <button type="submit" class="submit-button" [disabled]="productForm.invalid" style="flex: 1;">
            {{ editingProductId() ? 'Salvar Altera√ß√µes' : 'Cadastrar Produto' }}
          </button>
          
          @if (editingProductId()) {
            <button type="button" class="action-btn delete" (click)="cancelEditProduct()" style="padding: 0 20px;">
              Cancelar
            </button>
          }
        </div>

      </form>

      <hr class="divider">

      <h2>Produtos Cadastrados</h2>
      <div class="user-list-container">
        <table class="user-table">
          <thead>
            <tr>
              <th>Img</th>
              <th>Nome</th>
              <th>Pre√ßo</th>
              <th>Tamanhos</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            @for (prod of products(); track prod.id) {
              <tr [class.editing-row]="prod.id === editingProductId()">
                <td>
                  <img [src]="prod.images[0]" alt="" style="width: 40px; height: 40px; object-fit: contain;">
                </td>
                <td>
                  <strong>{{ prod.name }}</strong><br>
                  <small>{{ prod.category }}</small>
                </td>
                <td>R$ {{ prod.price }}</td>
                <td>
                  <small>{{ prod.sizes?.join(', ') || 'Unico' }}</small>
                </td>
                <td class="actions-cell">
                  <button class="action-btn edit" (click)="handleEditProduct(prod)" title="Editar">‚úèÔ∏è</button>
                  <button class="action-btn delete" (click)="handleDeleteProduct(prod.id)" title="Excluir">üóëÔ∏è</button>
                </td>
              </tr>
            } @empty {
              <tr><td colspan="5">Nenhum produto encontrado.</td></tr>
            }
          </tbody>
        </table>
      </div>
    }

  </section>
</div>

@if (isModalOpen()) {
  <div class="modal-backdrop" (click)="closePasswordModal()"></div>
  <div class="modal-panel">
     <div class="modal-header"><h3>Alterar Senha</h3><button class="close-btn" (click)="closePasswordModal()">√ó</button></div>
     <div class="modal-body">
       <form class="admin-form" [formGroup]="passwordForm" (ngSubmit)="handleChangePassword()">
         <input type="password" formControlName="newPassword" placeholder="Nova Senha">
         <button type="submit" class="submit-button">Salvar</button>
       </form>
     </div>
  </div>
}