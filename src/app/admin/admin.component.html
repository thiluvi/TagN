<div class="account-container">
  
    <aside class="account-sidebar">
      <div class="welcome-box">
        <h2>Painel Admin</h2>
        <p>Gerenciamento do Sistema</p>
      </div>
      <nav class="account-nav">
        <ul>
          <li>
            <button class="active">
              <span class="nav-icon"></span> Gerenciar Usuários
            </button>
          </li>
        </ul>
      </nav>
      <button class="logout-button" (click)="handleLogout()">Sair</button>
    </aside>
  
    <section class="account-content">
      
      @if (feedbackMessage(); as msg) {
        <div class="feedback-message" [class.success]="msg.type === 'success'" [class.error]="msg.type === 'error'">
          {{ msg.text }}
        </div>
      }
  
      <h2>Cadastrar Novo Usuário</h2>
      
      <form class="admin-form" [formGroup]="registerForm" (ngSubmit)="handleRegisterUser()">
        
        <div class="form-group">
          <label for="nome">Nome Completo</label>
          <input type="text" id="nome" formControlName="nome">
          @if (f.nome.invalid && (f.nome.dirty || f.nome.touched)) {
            <div class="field-error-message">
              @if (f.nome.hasError('required')) {
                <p>Nome é obrigatório.</p>
              }
            </div>
          }
        </div>
        
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" formControlName="email">
          @if (f.email.invalid && (f.email.dirty || f.email.touched)) {
            <div class="field-error-message">
              @if (f.email.hasError('required')) {
                <p>Email é obrigatório.</p>
              }
              @if (f.email.hasError('email')) {
                <p>Formato de email inválido (ex: nome@dominio.com).</p>
              }
            </div>
          }
        </div>
  
        <div class="form-group">
          <label for="cpf">CPF (somente números)</label>
          <input type="text" id="cpf" formControlName="cpf" placeholder="12345678900">
          @if (f.cpf.invalid && (f.cpf.dirty || f.cpf.touched)) {
            <div class="field-error-message">
              @if (f.cpf.hasError('required')) {
                <p>CPF é obrigatório.</p>
              }
              @if (f.cpf.hasError('pattern')) {
                <p>CPF deve conter apenas números.</p>
              }
              @if (f.cpf.hasError('minlength') || f.cpf.hasError('maxlength')) {
                <p>CPF deve ter exatamente 11 dígitos.</p>
              }
            </div>
          }
        </div>
        
        <div class="form-group">
          <label for="password">Senha Inicial</label>
          <input type="password" id="password" formControlName="password">
          @if (f.password.invalid && (f.password.dirty || f.password.touched)) {
            <div class="field-error-message">
              @if (f.password.hasError('required')) {
                <p>Senha é obrigatória.</p>
              }
            </div>
          }
        </div>
        
        <div class="form-group">
          <label for="role">Tipo de Conta</label>
          <select id="role" formControlName="role">
            <option value="user">Usuário Comum</option>
            <option value="admin">Administrador</option>
          </select>
        </div>
  
        <button type="submit" class="submit-button" [disabled]="registerForm.invalid">Cadastrar Usuário</button>
      </form>
  
      <hr class="divider">
  
      <h2>Lista de Usuários</h2>
      <div class="user-list-container">
        <table class="user-table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>CPF</th>
              <th>Permissão</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            @for (user of users(); track user.id) {
              <tr>
                <td>{{ user.nome }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.cpf }}</td>
                <td>{{ user.role }}</td>
                <td class="actions-cell">
                  <button class="action-btn edit" (click)="openPasswordModal(user)">Alterar Senha</button>
                  
                  @if (user.email !== 'admin@senac.com') {
                    <button class="action-btn delete" (click)="handleDeleteUser(user.id)">Deletar</button>
                  }
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="5">Nenhum usuário cadastrado.</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
  
    </section>
  
  </div>
  
  @if (isModalOpen()) {
    <div class="modal-backdrop" (click)="closePasswordModal()"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h3>Alterar Senha</h3>
        <button class="close-btn" (click)="closePasswordModal()">×</button>
      </div>
      <div class="modal-body">
        <p>Alterando senha para: <strong>{{ selectedUserForPassword()?.email }}</strong></p>
        
        <form class="admin-form" [formGroup]="passwordForm" (ngSubmit)="handleChangePassword()">
          <div class="form-group">
            <label for="newPassword">Nova Senha</label>
            <input type="password" id="newPassword" formControlName="newPassword">
            @if (passwordForm.controls.newPassword.invalid && (passwordForm.controls.newPassword.dirty || passwordForm.controls.newPassword.touched)) {
              <div class="field-error-message">
                <p>Nova senha é obrigatória.</p>
              </div>
            }
          </div>
          
          <div class="modal-footer">
            <button type="button" class="action-btn" (click)="closePasswordModal()">Cancelar</button>
            <button type="submit" class="submit-button" [disabled]="passwordForm.invalid">Salvar Senha</button>
          </div>
        </form>
      </div>
    </div>
  }